This is the reproduction of the kyber elastic exploit, for more details of the root issue, please refer to [link to X](https://twitter.com/0xdoug/status/1727613541115429314).

For now, this repo only contain exploit tests by using brute force method, is there any better way to do this?

## Reproduce the exploit in local test pool

This test setup a 1:1 pool and brute forcing to get a value to exploit the pool.

A particle attack can use a forked network and calculate the numbers needed in advance and use it in attack transaction.

```bash
forge test -vvv --mt testBruteForceExploit
```

It will take a while to run this test, since it's brute forcing.

## Fuzz test & probability analysis

Run fuzz to test if it can get an exploitable value (only 1 fuzz variable).

By default, foundry fuzzer only generate 256 cases, which is not enough to get a exploitable value. I've changed the config to 65535 so that the fuzz test can take effect on this simple case.

```bash
forge test -vvv --mt testFuzz
```

Test the probability of getting a exploitable value.

```bash
forge test -vvv -mt testProbability
```

This runs a simple for loop to get the valid values found in a given range.

Some of the found numbers when setting liquidity to `[80e18, 80e18+1e8]`:

```
  liquidity 80000000000009325512
  liquidity 80000000000009325561
  liquidity 80000000000009325610
  liquidity 80000000000009325660
  liquidity 80000000000009325709
  liquidity 80000000000009325759
  liquidity 80000000000009325808
  liquidity 80000000000009325857
  liquidity 80000000000009325907
  liquidity 80000000000009325956
  liquidity 80000000000009326055
  liquidity 80000000000009326104
  liquidity 80000000000009326154
  liquidity 80000000000009326203
  liquidity 80000000000009326252
  liquidity 80000000000009326302
  liquidity 80000000000009326351
  liquidity 80000000000009326401
  liquidity 80000000000009326450
  liquidity 80000000000009326499
  liquidity 80000000000009326549
  liquidity 80000000000009326598
  liquidity 80000000000009326648
  liquidity 80000000000009326697
  liquidity 80000000000009326746
  liquidity 80000000000009326796
  liquidity 80000000000009326845
  liquidity 80000000000009326895
  liquidity 80000000000009326944
  liquidity 80000000000009326993
  liquidity 80000000000009327043
  liquidity 80000000000009327092
  liquidity 80000000000009327141
  liquidity 80000000000009327191
  liquidity 80000000000009327240
  liquidity 80000000000009327290
  liquidity 80000000000009327339
  found 1983 in 10000000

Test result: ok. 1 passed; 0 failed; 0 skipped; finished in 84.69s

Ran 1 test suites: 1 tests passed, 0 failed, 0 skipped (1 total tests)
```

When setting liquidity range to `[20282409603651670423947251286016, 20693058119558072255662180724088]` and starts the liquidity amount from `80e18`, it found 1983 valid numbers in 10,000,000 tries. You can tweak the range and start liquidity amount to check the results in different cases.
